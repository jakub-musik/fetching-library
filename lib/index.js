"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var __assign=function(){return(__assign=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function __rest(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}function __awaiter(s,a,c,i){return new(c=c||Promise)(function(e,t){function r(e){try{o(i.next(e))}catch(e){t(e)}}function n(e){try{o(i.throw(e))}catch(e){t(e)}}function o(t){t.done?e(t.value):new c(function(e){e(t.value)}).then(r,n)}o((i=i.apply(s,a||[])).next())})}function __generator(r,n){var o,s,a,e,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(o)throw new TypeError("Generator is already executing.");for(;c;)try{if(o=1,s&&(a=2&t[0]?s.return:t[0]?s.throw||((a=s.return)&&a.call(s),0):s.next)&&!(a=a.call(s,t[1])).done)return a;switch(s=0,a&&(t=[2&t[0],a.value]),t[0]){case 0:case 1:a=t;break;case 4:return c.label++,{value:t[1],done:!1};case 5:c.label++,s=t[1],t=[0];continue;case 7:t=c.ops.pop(),c.trys.pop();continue;default:if(!(a=0<(a=c.trys).length&&a[a.length-1])&&(6===t[0]||2===t[0])){c=0;continue}if(3===t[0]&&(!a||t[1]>a[0]&&t[1]<a[3])){c.label=t[1];break}if(6===t[0]&&c.label<a[1]){c.label=a[1],a=t;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(t);break}a[2]&&c.ops.pop(),c.trys.pop();continue}t=n.call(r,c)}catch(e){t=[6,e],s=0}finally{o=a=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}function __spreadArrays(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),o=0;for(t=0;t<r;t++)for(var s=arguments[t],a=0,c=s.length;a<c;a++,o++)n[o]=s[a];return n}var requestJsonInterceptor=function(e){return function(o){return __awaiter(void 0,void 0,void 0,function(){var t,r,n;return __generator(this,function(e){return t=__assign({"Content-Type":"application/json; charset=utf-8"},o.headers),r=t["Content-Type"].includes("json"),n=o.body?r?JSON.stringify(o.body):o.body:void 0,[2,__assign(__assign(__assign({},o),{headers:t}),n&&{body:n})]})})}},emptyCodes=[204,205],responseJsonInterceptor=function(e){return function(e,u){return __awaiter(void 0,void 0,void 0,function(){var t,r,n,o,s,a,c,i;return __generator(this,function(e){switch(e.label){case 0:return(t=u.payload)&&"Response"===t.constructor.name?(r=t.headers.get("Content-Type"),n=emptyCodes.includes(t.status),o=!n&&r&&r.includes("json"),s=[__assign({},u)],a={},o?[4,t.json()]:[3,2]):[3,7];case 1:return c=e.sent(),[3,6];case 2:return n?[4,t.text()]:[3,4];case 3:return i=e.sent(),[3,5];case 4:i=t,e.label=5;case 5:c=i,e.label=6;case 6:return[2,__assign.apply(void 0,s.concat([(a.payload=c,a)]))];case 7:return[2,u]}})})}},responseTextInterceptor=function(e){return function(e,o){return __awaiter(void 0,void 0,void 0,function(){var t,r,n;return __generator(this,function(e){switch(e.label){case 0:return(t=o.payload)&&"Response"===t.constructor.name?(r=[__assign({},o)],n={},[4,t.text()]):[3,2];case 1:return[2,__assign.apply(void 0,r.concat([(n.payload=e.sent(),n)]))];case 2:return[2,o]}})})}},responseLoggerInterceptor=function(n){return function(e){return function(t,r){return __awaiter(void 0,void 0,void 0,function(){return __generator(this,function(e){return n({action:t,response:r}),[2,r]})})}}},requestLoggerInterceptor=function(r){return function(e){return function(t){return __awaiter(void 0,void 0,void 0,function(){return __generator(this,function(e){return r({action:t}),[2,t]})})}}},createClient=function(u){var l=u||{},p=l.cacheProvider,f=function(s,a){return __awaiter(void 0,void 0,void 0,function(){var t,r,n,o;return __generator(this,function(e){switch(e.label){case 0:return(t=a[0],r=a.slice(1),t)?(o=f,[4,t(_)(s)]):[3,3];case 1:return[4,o.apply(void 0,[e.sent(),r])];case 2:return n=e.sent(),[3,4];case 3:n=s,e.label=4;case 4:return[2,n]}})})},d=function(a,c,i){return __awaiter(void 0,void 0,void 0,function(){var t,r,n,o,s;return __generator(this,function(e){switch(e.label){case 0:return(t=i[0],r=i.slice(1),t)?(o=d,s=[a],[4,t(_)(a,c)]):[3,3];case 1:return[4,o.apply(void 0,s.concat([e.sent(),r]))];case 2:return n=e.sent(),[3,4];case 3:n=c,e.label=4;case 4:return[2,n]}})})},_={cache:p,query:function(c,i){return void 0===i&&(i=!1),__awaiter(void 0,void 0,void 0,function(){var t,r,n,o,s,a;return __generator(this,function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),[4,f(c,l.requestInterceptors||[requestJsonInterceptor])];case 1:return t=e.sent(),r=t.endpoint,n=__rest(t,["endpoint"]),p&&!i&&(o=p.get(c))?[2,o]:[4,((null==u?void 0:u.customFetch)||fetch)(r,n)];case 2:return s=e.sent(),[4,d(t,{error:!s.ok,headers:s.headers,payload:s,status:s.status},l.responseInterceptors||[responseJsonInterceptor,responseTextInterceptor])];case 3:return a=e.sent(),p&&s.ok&&p.add(c,a),[2,a];case 4:return[2,{error:!0,errorObject:e.sent()}];case 5:return[2]}})})}};return _},convertActionToBase64=function(e){return Buffer.from(JSON.stringify(e)).toString("base64")},createCache=function(r,n){function o(e){delete s[convertActionToBase64(e)]}var s={};return{add:function(e,t){r(e)&&(s[convertActionToBase64(e)]=__assign(__assign({},t),{timestamp:Date.now()}))},get:function(e){var t=s[convertActionToBase64(e)],r=t&&n(t);if(r)return t;t&&!r&&o(e)},getItems:function(){return s},remove:o,setItems:function(e){s=e}}},defaultOptions={collapse:!0,show:!0},formatTitle=function(e){var t=e.action,r=e.response,n=t.id||t.endpoint,o=r?"Response":"Request";return{title:__spreadArrays(["%c "+o+" %c "+n],["color: "+(r&&r.error?"red":"gray"),"color: gray; font-weight: normal"]),simpleTitle:o+" "+n}},createLogger=function(s){return function(t){var e=__assign(__assign({},defaultOptions),s);if(e.show){var r=formatTitle(t),n=r.title,o=r.simpleTitle;try{e.collapse?console.groupCollapsed.apply(console,n):console.group.apply(console,n)}catch(e){console.log(o)}Object.keys(t).forEach(function(e){console.log("%c "+e,"font-weight: bold",t[e])});try{console.groupEnd()}catch(e){console.log("-- END --")}}}};exports.convertActionToBase64=convertActionToBase64,exports.createCache=createCache,exports.createClient=createClient,exports.createLogger=createLogger,exports.requestJsonInterceptor=requestJsonInterceptor,exports.requestLoggerInterceptor=requestLoggerInterceptor,exports.responseJsonInterceptor=responseJsonInterceptor,exports.responseLoggerInterceptor=responseLoggerInterceptor,exports.responseTextInterceptor=responseTextInterceptor;
